/*! (c) Philipp KÃ¶nig under GPL-3.0 */
(e=>{"use strict";(new function(){this.isDev=!1;let e=null,t=()=>new Promise(t=>{let n=chrome.runtime.getManifest();e=+new Date;let r={css:"insertCSS",js:"executeScript"};chrome.tabs.query({},e=>{e.forEach(e=>{void 0!==e.url&&(e.url.startsWith("chrome://")||e.url.startsWith("chrome-extension://"))||Object.entries(r).forEach(([t,r])=>{n.content_scripts[0][t].forEach(t=>{chrome.tabs[r](e.id,{file:t},function(){chrome.runtime.lastError})})})}),t()})}),n=()=>new Promise(e=>{chrome.tabs.query({active:!0,currentWindow:!0},t=>{chrome.tabs.remove(t[0].id),e()})});this.run=(()=>{let r=chrome.runtime.getManifest();this.isDev="Dev"===r.version_name||!("update_url"in r);let i=+new Date;Promise.all([(async()=>{chrome.browserAction.onClicked.addListener(()=>{chrome.tabs.query({active:!0,currentWindow:!0},t=>{chrome.tabs.sendMessage(t[0].id,{action:"navigateBack",reinitialized:e})})})})(),(async()=>{let e={closeTab:n,reinitialize:t};chrome.runtime.onConnect.addListener(t=>{t.name&&"background"===t.name&&t.onMessage.addListener((n,r)=>{e[n.type]&&(n.tabInfo=r.sender.tab,e[n.type](n).then(e=>{try{t.postMessage({uid:n.uid,result:e})}catch(e){}}))})})})()]).then(()=>{this.isDev&&console&&console.log&&console.log("Finished loading background script",+new Date-i)})})}).run()})(jsu);