/*! (c) Philipp KÃ¶nig under GPL-3.0 */
(e=>{"use strict";(new function(){this.isDev=!1;let e=null,t={},r=!1,s=()=>new Promise(t=>{let r=chrome.runtime.getManifest();e=+new Date;let s={css:"insertCSS",js:"executeScript"};chrome.tabs.query({},e=>{e.forEach(e=>{void 0!==e.url&&(e.url.startsWith("chrome://")||e.url.startsWith("chrome-extension://"))||Object.entries(s).forEach(([t,s])=>{r.content_scripts[0][t].forEach(t=>{chrome.tabs[s](e.id,{file:t},function(){chrome.runtime.lastError})})})}),t()})}),a=()=>new Promise(e=>{chrome.tabs.query({active:!0,currentWindow:!0},t=>{chrome.tabs.remove(t[0].id),e()})});this.run=(()=>{let n=chrome.runtime.getManifest();this.isDev="Dev"===n.version_name||!("update_url"in n);let i=+new Date;Promise.all([(async()=>{chrome.browserAction.onClicked.addListener(()=>{chrome.tabs.query({active:!0,currentWindow:!0},t=>{chrome.tabs.sendMessage(t[0].id,{action:"navigateBack",reinitialized:e})})})})(),(async()=>{let e={closeTab:a,reinitialize:s};chrome.runtime.onConnect.addListener(t=>{t.name&&"background"===t.name&&t.onMessage.addListener((r,s)=>{e[r.type]&&(r.tabInfo=s.sender.tab,e[r.type](r).then(e=>{try{t.postMessage({uid:r.uid,result:e})}catch(e){}}))})})})(),(()=>new Promise(e=>{chrome.storage.sync.get(["model","shareUserdata"],s=>{t=s.model||{},r=void 0===s.shareUserdata?null:s.shareUserdata,void 0===t.installationDate&&(t.installationDate=+new Date);let a=+(new Date).setHours(0,0,0,0);void 0!==t.lastTrackDate&&t.lastTrackDate===a||(t.lastTrackDate=a),chrome.storage.sync.set({model:t},()=>{e()})})}))()]).then(()=>{this.isDev&&console.log("LOADED",+new Date-i)})})}).run()})(jsu);